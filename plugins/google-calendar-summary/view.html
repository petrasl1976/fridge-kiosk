{% if plugin['data'] %}
  {% if plugin['data'].error %}
    <div class="calendar-widget" style="font-size: {{ plugin['config'].format.font_size }}; color: red; padding: {{ plugin['config'].format.padding }};">
      <h3>Google Calendar Error</h3>
      <p>{{ plugin['data'].error }}</p>
    </div>
  {% else %}
    <div class="calendar-widget summary-list" style="font-size: {{ plugin['config'].format.font_size }}; color: {{ plugin['config'].format.color }}; padding: {{ plugin['config'].format.padding }}; text-align: right; display: flex; flex-direction: column; align-items: flex-end;">
      
      <!-- Detailed Weather Forecast Section -->
      {% set w = plugin['data'].weather_now %}
      {% if w and w.temperature is defined and w.temperature is not none %}
        <div class="summary-weather-detailed" style="margin-bottom: 20px; text-align: right; border: 1px solid #444; padding: 12px; border-radius: 8px; background: rgba(0,0,0,0.2); width: 100%; box-sizing: border-box;">
          <div class="weather-header" style="font-size: 1.1em; font-weight: bold; margin-bottom: 8px; color: #87CEEB;">
            Dabar
          </div>
          <div class="weather-main" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
            <div class="weather-temp" style="font-size: 1.8em; font-weight: bold;">
              {{ w.temperature }}°C
            </div>
            <div class="weather-condition" style="text-align: right;">
              <div style="font-size: 0.9em; color: #ccc;">{{ w.conditionCode or 'N/A' }}</div>
              {% if w.forecastTimeUtc %}
              <div style="font-size: 0.8em; color: #888;">{{ w.forecastTimeUtc }}</div>
              {% endif %}
            </div>
          </div>
          <div class="weather-details" style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px; font-size: 0.85em;">
            <div>Jaučiasi: {{ w.feelsLike or 'N/A' }}°C</div>
            <div>Vėjas: {{ w.windSpeed or 'N/A' }} m/s</div>
            <div>Spaudimas: {{ w.pressure or 'N/A' }} hPa</div>
            <div>Drėgmė: {{ w.humidity or 'N/A' }}%</div>
            {% if w.precipitation and w.precipitation > 0 %}
            <div style="grid-column: span 2; color: #87CEEB;">Krituliai: {{ w.precipitation }} mm</div>
            {% endif %}
          </div>
        </div>
      {% elif w %}
        <!-- Weather data exists but is incomplete -->
        <div class="summary-weather-detailed" style="margin-bottom: 20px; text-align: right; border: 1px solid #444; padding: 12px; border-radius: 8px; background: rgba(0,0,0,0.2); width: 100%; box-sizing: border-box;">
          <div class="weather-header" style="font-size: 1.1em; font-weight: bold; margin-bottom: 8px; color: #87CEEB;">
            Dabar
          </div>
          <div style="font-size: 0.9em; color: #888;">
            Kraunama orų prognozė...
          </div>
        </div>
      {% else %}
        <!-- No weather data available -->
        <div class="summary-weather-detailed" style="margin-bottom: 20px; text-align: right; border: 1px solid #444; padding: 12px; border-radius: 8px; background: rgba(0,0,0,0.2); width: 100%; box-sizing: border-box;">
          <div class="weather-header" style="font-size: 1.1em; font-weight: bold; margin-bottom: 8px; color: #87CEEB;">
            Dabar
          </div>
          <div style="font-size: 0.9em; color: #888;">
            Orų duomenys nepasiekiami
          </div>
        </div>
      {% endif %}
      
      <!-- Today's Events Section -->
      {% if plugin['data'].today_events %}
        <div class="summary-section" style="width: 100%; margin-bottom: 15px;">
          <div class="section-header" style="font-size: 0.9em; color: #87CEEB; margin-bottom: 8px; text-align: right;">
            Šiandien
          </div>
          <div class="summary-events-col" style="display: flex; flex-direction: column; align-items: flex-end;">
            {% for event in plugin['data'].today_events %}
              <div class="summary-event" style="color: #fff; display: flex; justify-content: flex-end; align-items: center; margin-bottom: 6px;">
                <span class="summary-title" style="margin-right: 8px;">{{ event.summary }}</span>
                <span class="summary-time" style="background: {{ event.color }}; color: #fff; padding: 2px 8px; border-radius: 4px; min-width: 3em;">{{ event.formatted_time }}</span>
              </div>
            {% endfor %}
          </div>
        </div>
      {% endif %}
      
      <!-- Tomorrow's Events Section -->
      {% if plugin['data'].tomorrow_events %}
        <div class="summary-section" style="width: 100%;">
          <div class="section-header" style="font-size: 0.9em; color: #87CEEB; margin-bottom: 8px; text-align: right;">
            Rytoj
          </div>
          <div class="summary-events-col" style="display: flex; flex-direction: column; align-items: flex-end;">
            {% for event in plugin['data'].tomorrow_events %}
              <div class="summary-event" style="color: #fff; display: flex; justify-content: flex-end; align-items: center; margin-bottom: 6px;">
                <span class="summary-title" style="margin-right: 8px;">{{ event.summary }}</span>
                <span class="summary-time" style="background: {{ event.color }}; color: #fff; padding: 2px 8px; border-radius: 4px; min-width: 3em;">{{ event.formatted_time }}</span>
              </div>
            {% endfor %}
          </div>
        </div>
      {% endif %}
      
      {% if not plugin['data'].today_events and not plugin['data'].tomorrow_events %}
        <div style="color: #888;">Nėra artimiausių įvykių</div>
      {% endif %}
    </div>
  {% endif %}
{% else %}
  <div class="calendar-widget" style="color: red; padding: 20px;">Duomenų nėra</div>
{% endif %} 